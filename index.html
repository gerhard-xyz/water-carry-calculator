<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Hiking Water Carry Calculator</title>
    <link rel="preconnect" href="https://js.arcgis.com">
    <link rel="stylesheet" href="https://js.arcgis.com/calcite-components/2.8.0/calcite.css" />
    <script type="module" src="https://js.arcgis.com/calcite-components/2.8.0/calcite.esm.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--calcite-sans-family);
            background: var(--calcite-color-background);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: max(24px, env(safe-area-inset-top)) max(24px, env(safe-area-inset-right)) max(24px, env(safe-area-inset-bottom)) max(24px, env(safe-area-inset-left));
        }

        .calculator-container {
            background: var(--calcite-color-foreground-1);
            max-width: 480px;
            width: 100%;
            padding: 48px 40px;
        }

        h1 {
            color: var(--calcite-color-text-1);
            font-size: 28px;
            font-weight: 400;
            margin-bottom: 8px;
            letter-spacing: -0.02em;
        }

        .subtitle {
            color: var(--calcite-color-text-2);
            font-size: 15px;
            margin-bottom: 40px;
            font-weight: 400;
        }

        calcite-segmented-control {
            margin-bottom: 40px;
        }

        .input-group {
            margin-bottom: 28px;
        }

        calcite-input-number {
            width: 100%;
        }

        calcite-switch {
            font-size: 14px;
            font-weight: 400;
        }

        .switch-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .switch-label {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex: 1;
            gap: 6px;
        }

        .switch-label span {
            color: var(--calcite-color-text-1);
            font-size: 13px;
            font-weight: 400;
            letter-spacing: 0.01em;
        }

        calcite-button {
            width: 100%;
            margin-top: 36px;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 36px;
        }

        .button-group calcite-button {
            flex: 1;
            margin-top: 0;
        }

        #result-card {
            margin-top: 40px;
        }

        .result-content {
            padding: 24px 16px;
        }

        .result-header {
            text-align: center;
            padding-bottom: 8px;
            margin-bottom: 20px;
        }

        .result-amount {
            font-size: 56px;
            font-weight: 300;
            color: var(--calcite-color-brand);
            margin-bottom: 8px;
            letter-spacing: -0.03em;
        }

        .result-label {
            color: var(--calcite-color-text-2);
            font-size: 14px;
            margin-bottom: 4px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .result-duration {
            color: var(--calcite-color-text-3);
            font-size: 13px;
            font-weight: 400;
        }

        .result-details {
            color: var(--calcite-color-text-2);
            font-size: 13px;
            line-height: 1.6;
            font-weight: 400;
            text-align: left;
        }

        .result-details p {
            margin: 0 0 8px 0;
        }

        .result-details p:last-child:not(.result-disclaimer) {
            margin-bottom: 0;
        }

        .result-disclaimer {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--calcite-color-border-3);
            font-size: 12px;
            color: var(--calcite-color-text-3);
            font-style: italic;
        }

        calcite-label {
            color: var(--calcite-color-text-1);
            font-size: 13px;
            font-weight: 400;
            letter-spacing: 0.01em;
        }

        calcite-slider {
            margin-top: 12px;
        }

        .label-with-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 6px;
        }

        .info-icon {
            cursor: pointer;
            color: var(--calcite-color-text-3);
            font-size: 14px;
        }

        .info-icon:hover {
            color: var(--calcite-color-brand);
        }

        calcite-popover {
            max-width: 280px;
        }

        .popover-content {
            padding: 12px;
            font-size: 13px;
            line-height: 1.5;
        }

        .popover-content strong {
            display: block;
            margin-bottom: 8px;
        }

        .popover-content p {
            margin: 0;
        }

        .multiplier {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--calcite-color-border-3);
            font-weight: 500;
            color: var(--calcite-color-brand);
        }

        .required-indicator {
            color: #d83020;
            margin-left: 4px;
            display: inline-flex;
            align-items: center;
            vertical-align: middle;
        }

        .validation-popover {
            --calcite-color-foreground-1: var(--calcite-color-danger);
        }

        .validation-popover .popover-content {
            color: var(--calcite-color-text-inverse);
        }

        @media (max-width: 480px) {
            body {
                padding: max(16px, env(safe-area-inset-top)) max(16px, env(safe-area-inset-right)) max(16px, env(safe-area-inset-bottom)) max(16px, env(safe-area-inset-left));
            }

            .calculator-container {
                padding: 32px 24px;
            }

            h1 {
                font-size: 24px;
            }

            .result-amount {
                font-size: 48px;
            }
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <h1>Water carry calculator</h1>
        <p class="subtitle">Calculate how much water you need for your hike</p>

        <calcite-segmented-control id="unit-control" scale="m" width="auto">
            <calcite-segmented-control-item value="metric" checked>Metric</calcite-segmented-control-item>
            <calcite-segmented-control-item value="imperial">Imperial</calcite-segmented-control-item>
        </calcite-segmented-control>

        <form id="calculator-form">
            <div class="input-group">
                <calcite-label>
                    <div class="label-with-info">
                        <span id="distance-label">Distance (km)<span class="required-indicator" id="distance-required"><calcite-icon aria-hidden="true" scale="s" icon="bullet-point"></calcite-icon></span></span>
                        <calcite-action id="distance-info" icon="information" text="Info" scale="s" class="info-icon"></calcite-action>
                    </div>
                    <calcite-input-number id="distance" step="0.1" min="0" value="20" 
                        icon-start="walk" required scale="m" inputmode="decimal">
                    </calcite-input-number>
                </calcite-label>
                <calcite-popover reference-element="distance-required" placement="top" trigger="hover">
                    <div class="popover-content">
                        Required
                    </div>
                </calcite-popover>
                <calcite-popover id="distance-validation" reference-element="distance" placement="top" auto-close class="validation-popover" style="display: none;">
                    <div class="popover-content">
                        <strong>Required field</strong>
                        <p>Please enter a valid distance greater than 0.</p>
                    </div>
                </calcite-popover>
                <calcite-popover reference-element="distance-info" placement="auto" auto-close>
                    <div class="popover-content">
                        <strong>Why distance matters</strong>
                        <p>Longer distances mean more time on the trail and more physical exertion. Your body loses water through perspiration, breathing, and metabolic processes.</p>
                    </div>
                </calcite-popover>
            </div>

            <div class="input-group">
                <calcite-label>
                    <div class="label-with-info">
                        <span id="pace-label">Pace (km/h)<span class="required-indicator" id="pace-required"><calcite-icon aria-hidden="true" scale="s" icon="bullet-point"></calcite-icon></span></span>
                        <calcite-action id="pace-info" icon="information" text="Info" scale="s" class="info-icon"></calcite-action>
                    </div>
                    <calcite-input-number id="pace" step="0.1" min="0.1" value="4" 
                        icon-start="clock" required scale="m" inputmode="decimal">
                    </calcite-input-number>
                </calcite-label>
                <calcite-popover reference-element="pace-required" placement="top" trigger="hover">
                    <div class="popover-content">
                        Required
                    </div>
                </calcite-popover>
                <calcite-popover id="pace-validation" reference-element="pace" placement="top" auto-close class="validation-popover" style="display: none;">
                    <div class="popover-content">
                        <strong>Required field</strong>
                        <p>Please enter a valid pace greater than 0.</p>
                    </div>
                </calcite-popover>
                <calcite-popover reference-element="pace-info" placement="auto" auto-close>
                    <div class="popover-content">
                        <strong>Why pace matters</strong>
                        <p>Your hiking pace determines how long you'll be on the trail. Faster paces mean shorter trips but higher exertion. Typical hiking pace is 4km/h (2.5mph) on flat terrain, slower with elevation gain or heavy pack.</p>
                    </div>
                </calcite-popover>
            </div>

            <div class="input-group">
                <calcite-label>
                    <div class="label-with-info">
                        <span id="elevation-label">Elevation gain (meters)<span class="required-indicator" id="elevation-required"><calcite-icon aria-hidden="true" scale="s" icon="bullet-point"></calcite-icon></span></span>
                        <calcite-action id="elevation-info" icon="information" text="Info" scale="s" class="info-icon"></calcite-action>
                    </div>
                    <calcite-input-number id="elevation" step="10" min="0" value="1000" 
                        icon-start="altitude" required scale="m" inputmode="decimal">
                    </calcite-input-number>
                </calcite-label>
                <calcite-popover reference-element="elevation-required" placement="top" trigger="hover">
                    <div class="popover-content">
                        Required
                    </div>
                </calcite-popover>
                <calcite-popover id="elevation-validation" reference-element="elevation" placement="top" auto-close class="validation-popover" style="display: none;">
                    <div class="popover-content">
                        <strong>Required field</strong>
                        <p>Please enter a valid elevation (0 or greater).</p>
                    </div>
                </calcite-popover>
                <calcite-popover reference-element="elevation-info" placement="auto" auto-close>
                    <div class="popover-content">
                        <strong>Why elevation gain matters</strong>
                        <p>Climbing requires significantly more energy and oxygen. Every 300m (1,000ft) of elevation gain roughly equals 1km of flat distance in effort. Higher altitudes also increase respiratory water loss due to lower humidity and increased breathing rate.</p>
                    </div>
                </calcite-popover>
            </div>

            <div class="input-group">
                <calcite-label>
                    <div class="label-with-info">
                        <span id="temp-label">Air temperature (°C)<span class="required-indicator" id="temp-required"><calcite-icon aria-hidden="true" scale="s" icon="bullet-point"></calcite-icon></span></span>
                        <calcite-action id="temp-info" icon="information" text="Info" scale="s" class="info-icon"></calcite-action>
                    </div>
                    <calcite-input-number id="temperature" step="1" value="20" 
                        icon-start="temperature" required scale="m" inputmode="decimal">
                    </calcite-input-number>
                </calcite-label>
                <calcite-popover reference-element="temp-required" placement="top" trigger="hover">
                    <div class="popover-content">
                        Required
                    </div>
                </calcite-popover>
                <calcite-popover id="temp-validation" reference-element="temperature" placement="top" auto-close class="validation-popover" style="display: none;">
                    <div class="popover-content">
                        <strong>Required field</strong>
                        <p>Please enter a valid temperature.</p>
                    </div>
                </calcite-popover>
                <calcite-popover reference-element="temp-info" placement="auto" auto-close>
                    <div class="popover-content">
                        <strong>Why temperature matters</strong>
                        <p>Higher temperatures dramatically increase sweat production to cool your body. At 85°F+, you can lose 2x more water than at moderate temperatures. Cold weather also requires hydration, though less so.</p>
                    </div>
                </calcite-popover>
            </div>

            <div class="input-group">
                <calcite-label>
                    <div class="label-with-info">
                        <span>UV index</span>
                        <calcite-action id="uv-info" icon="information" text="Info" scale="s" class="info-icon"></calcite-action>
                    </div>
                </calcite-label>
                <calcite-slider min="0" max="11" value="0" step="1" ticks="1" label-ticks
                    id="uv-slider" scale="m"></calcite-slider>
                <calcite-popover reference-element="uv-info" placement="auto" auto-close>
                    <div class="popover-content">
                        <strong>Why UV index matters</strong>
                        <p>UV radiation heats your skin and increases core body temperature, causing you to sweat more to maintain cooling. Higher UV also means more direct sun exposure, compounding heat effects. UV increases ~10-12% per 1,000 meters elevation.</p>
                    </div>
                </calcite-popover>
            </div>

            <div class="input-group">
                <div class="switch-container">
                    <calcite-switch id="mouth-breather" scale="m"></calcite-switch>
                    <div class="switch-label">
                        <span>Mouth breather</span>
                        <calcite-action id="mouth-breather-info" icon="information" text="Info" scale="s" class="info-icon"></calcite-action>
                    </div>
                </div>
                <calcite-popover reference-element="mouth-breather-info" placement="auto" auto-close>
                    <div class="popover-content">
                        <strong>Why mouth breathing matters</strong>
                        <p>Breathing through your mouth during exercise increases water loss through respiration by about 15%. Mouth breathing bypasses the nasal passages which normally humidify exhaled air, leading to more moisture loss with each breath.</p>
                        <div class="multiplier">Multiplier: 1.15×</div>
                    </div>
                </calcite-popover>
            </div>

            <div class="input-group">
                <div class="switch-container">
                    <calcite-switch id="heavy-sweater" scale="m"></calcite-switch>
                    <div class="switch-label">
                        <span>Heavy sweater</span>
                        <calcite-action id="heavy-sweater-info" icon="information" text="Info" scale="s" class="info-icon"></calcite-action>
                    </div>
                </div>
                <calcite-popover reference-element="heavy-sweater-info" placement="auto" auto-close>
                    <div class="popover-content">
                        <strong>Why sweating rate matters</strong>
                        <p>Some people naturally sweat more due to genetics, fitness level, or higher sweat gland density. Heavy sweaters can lose 20-30% more fluid during exercise compared to average, requiring additional water intake to maintain proper hydration and performance.</p>
                        <div class="multiplier">Multiplier: 1.25×</div>
                    </div>
                </calcite-popover>
            </div>

            <div class="button-group">
                <calcite-button type="submit" width="full" scale="m">Calculate</calcite-button>
                <calcite-button type="button" id="reset-btn" width="full" scale="m" kind="neutral">Reset</calcite-button>
            </div>
        </form>

        <calcite-card id="result-card" style="display: none;">
            <div class="result-content">
                <div class="result-header">
                    <div class="result-amount" id="result-amount">0</div>
                    <div class="result-label" id="result-label">liters</div>
                    <div class="result-duration" id="result-duration"></div>
                </div>
                <div class="result-details" id="result-details"></div>
            </div>
        </calcite-card>
    </div>

    <script type="module">
        // Apply dark mode class to body for Calcite components
        const darkModeQuery = window.matchMedia('(prefers-color-scheme: dark)');
        const updateTheme = (e) => {
            document.body.classList.toggle('calcite-mode-dark', e.matches);
        };
        updateTheme(darkModeQuery);
        darkModeQuery.addEventListener('change', updateTheme);

        let currentUnit = 'metric';
        let lastResult = null;

        const uvSlider = document.getElementById('uv-slider');
        const labels = {
            distance: document.getElementById('distance-label'),
            temp: document.getElementById('temp-label'),
            elevation: document.getElementById('elevation-label'),
            pace: document.getElementById('pace-label')
        };
        const unitLabels = {
            metric: { distance: 'Distance (km)<span class="required-indicator" id="distance-required"><calcite-icon aria-hidden="true" scale="s" icon="bullet-point"></calcite-icon></span>', temp: 'Air temperature (°C)<span class="required-indicator" id="temp-required"><calcite-icon aria-hidden="true" scale="s" icon="bullet-point"></calcite-icon></span>', elevation: 'Elevation gain (meters)<span class="required-indicator" id="elevation-required"><calcite-icon aria-hidden="true" scale="s" icon="bullet-point"></calcite-icon></span>', pace: 'Pace (km/h)<span class="required-indicator" id="pace-required"><calcite-icon aria-hidden="true" scale="s" icon="bullet-point"></calcite-icon></span>' },
            imperial: { distance: 'Distance (miles)<span class="required-indicator" id="distance-required"><calcite-icon aria-hidden="true" scale="s" icon="bullet-point"></calcite-icon></span>', temp: 'Air temperature (°F)<span class="required-indicator" id="temp-required"><calcite-icon aria-hidden="true" scale="s" icon="bullet-point"></calcite-icon></span>', elevation: 'Elevation gain (feet)<span class="required-indicator" id="elevation-required"><calcite-icon aria-hidden="true" scale="s" icon="bullet-point"></calcite-icon></span>', pace: 'Pace (mph)<span class="required-indicator" id="pace-required"><calcite-icon aria-hidden="true" scale="s" icon="bullet-point"></calcite-icon></span>' }
        };

        uvSlider.histogram = Array.from({length: 12}, (_, i) => [i, i * 5]);
        uvSlider.histogramStops = [
            { offset: 0, color: '#92D050' },        // Green start (0)
            { offset: 2/11, color: '#92D050' },     // Green end (2)
            { offset: 2/11, color: '#FFFF00' },     // Yellow start (2)
            { offset: 5/11, color: '#FFFF00' },     // Yellow end (5)
            { offset: 5/11, color: '#FFA500' },     // Orange start (5)
            { offset: 7/11, color: '#FFA500' },     // Orange end (7)
            { offset: 7/11, color: '#FF0000' },     // Red start (7)
            { offset: 10/11, color: '#FF0000' },    // Red end (10)
            { offset: 10/11, color: '#8B00FF' },    // Violet start (10)
            { offset: 1, color: '#8B00FF' }         // Violet end (11)
        ];

        setTimeout(() => {
            const label = uvSlider.shadowRoot?.querySelectorAll('.tick__label');
            if (label?.[11]) label[11].textContent = '11+';
        }, 300);

        // Setup hover popovers for required indicators
        const setupRequiredPopover = (indicatorId, popoverId) => {
            const indicator = document.getElementById(indicatorId);
            const popover = document.querySelector(`calcite-popover[reference-element="${indicatorId}"]`);
            
            if (indicator && popover) {
                indicator.addEventListener('mouseenter', () => {
                    popover.open = true;
                });
                indicator.addEventListener('mouseleave', () => {
                    popover.open = false;
                });
            }
        };

        setTimeout(() => {
            setupRequiredPopover('distance-required');
            setupRequiredPopover('pace-required');
            setupRequiredPopover('elevation-required');
            setupRequiredPopover('temp-required');
        }, 500);

        document.getElementById('unit-control').addEventListener('calciteSegmentedControlChange', e => {
            currentUnit = e.target.value;
            Object.entries(unitLabels[currentUnit]).forEach(([key, text]) => labels[key].innerHTML = text);
            
            // Re-setup hover popovers after label update
            setTimeout(() => {
                setupRequiredPopover('distance-required');
                setupRequiredPopover('pace-required');
                setupRequiredPopover('elevation-required');
                setupRequiredPopover('temp-required');
            }, 100);
            
            // Convert defaults when switching units
            const distanceInput = document.getElementById('distance');
            const paceInput = document.getElementById('pace');
            const elevationInput = document.getElementById('elevation');
            const tempInput = document.getElementById('temperature');
            
            if (currentUnit === 'imperial') {
                // Convert to imperial
                if (parseFloat(distanceInput.value) === 20) distanceInput.value = '12.4';
                if (parseFloat(paceInput.value) === 4) paceInput.value = '2.5';
                if (parseFloat(elevationInput.value) === 1000) elevationInput.value = '3281';
                if (parseFloat(tempInput.value) === 20) tempInput.value = '68';
            } else {
                // Convert to metric
                if (parseFloat(distanceInput.value) === 12.4) distanceInput.value = '20';
                if (parseFloat(paceInput.value) === 2.5) paceInput.value = '4';
                if (parseFloat(elevationInput.value) === 3281) elevationInput.value = '1000';
                if (parseFloat(tempInput.value) === 68) tempInput.value = '20';
            }
            
            // Update result display if we have a previous calculation
            if (lastResult) {
                updateResultDisplay(lastResult);
            }
        });

        document.getElementById('reset-btn').addEventListener('click', () => {
            document.getElementById('calculator-form').reset();
            uvSlider.value = 0;
            // Reset to appropriate defaults for current unit
            if (currentUnit === 'imperial') {
                document.getElementById('distance').value = '12.4';
                document.getElementById('pace').value = '2.5';
                document.getElementById('elevation').value = '3281';
                document.getElementById('temperature').value = '68';
            } else {
                document.getElementById('distance').value = '20';
                document.getElementById('pace').value = '4';
                document.getElementById('elevation').value = '1000';
                document.getElementById('temperature').value = '20';
            }
            document.getElementById('result-card').style.display = 'none';
            lastResult = null;
        });

        function calculateWater(distance, pace, temp, uvIndex, elevation, isMouthBreather, isHeavySweater, unit) {
            const toMetric = unit === 'imperial';
            const distanceKm = toMetric ? distance * 1.60934 : distance;
            const paceKmh = toMetric ? pace * 1.60934 : pace;
            const tempC = toMetric ? (temp - 32) * 5/9 : temp;
            const elevationM = toMetric ? elevation * 0.3048 : elevation;

            const hours = (distanceKm + elevationM / 300) / paceKmh;
            const tempMult = tempC < 10 ? 0.8 : tempC < 21 ? 1 : tempC < 27 ? 1.3 : tempC < 32 ? 1.6 : 2;
            const uvMult = uvIndex <= 2 ? 0.9 : uvIndex <= 5 ? 1 : uvIndex <= 7 ? 1.15 : uvIndex <= 10 ? 1.3 : 1.4;
            const elevMult = elevationM > 2500 ? 1.2 : elevationM > 1500 ? 1.1 : 1;
            const mouthMult = isMouthBreather ? 1.15 : 1;
            const sweatMult = isHeavySweater ? 1.25 : 1;

            return {
                liters: hours * 0.5 * tempMult * uvMult * elevMult * mouthMult * sweatMult + 0.5,
                hours,
                factors: { temp: tempMult, uv: uvMult, elevation: elevMult, mouthBreather: mouthMult, heavySweater: sweatMult },
                uvIndex: uvIndex
            };
        }

        function updateResultDisplay(result) {
            const isImperial = currentUnit === 'imperial';
            const displayAmount = (isImperial ? result.liters * 33.814 : result.liters).toFixed(1);
            const displayUnit = isImperial ? 'fl oz' : 'liters';

            document.getElementById('result-amount').textContent = displayAmount;
            document.getElementById('result-label').textContent = displayUnit;
            document.getElementById('result-duration').textContent = `For your ${result.hours.toFixed(1)}-hour hike`;

            let details = '';
            
            if (result.factors.mouthBreather > 1) details += '<p>Extra water added for mouth breathing.</p>';
            if (result.factors.heavySweater > 1) details += '<p>Extra water added for higher sweat rate.</p>';
            if (result.factors.temp > 1.5) details += '<p>Hot weather! Stay hydrated and take frequent breaks in shade.</p>';
            
            if (result.factors.uv > 1.3) {
                const uv = result.uvIndex;
                details += uv >= 11 ? '<p>Extreme UV exposure. Wear protective clothing, wide-brimmed hat, and SPF 50+ sunscreen. Reapply every 2 hours.</p>' :
                           uv >= 8 ? '<p>Very high UV exposure. Wear sunglasses, hat, and SPF 30+ sunscreen. Seek shade during peak hours.</p>' :
                           uv >= 6 ? '<p>High UV exposure. Use SPF 30+ sunscreen and wear a hat. Cover up when possible.</p>' :
                           '<p>Moderate UV exposure. Use SPF 15+ sunscreen and consider wearing a hat.</p>';
            }
            
            if (result.factors.elevation > 1.1) details += '<p>High elevation increases UV intensity and dehydration. Drink before you feel thirsty.</p>';

            details += '<div class="result-disclaimer">Includes 0.5L emergency reserve. Adjust based on personal sweat rate and fitness level.</div>';

            document.getElementById('result-details').innerHTML = details;
            document.getElementById('result-card').style.display = 'block';
        }

        document.getElementById('calculator-form').addEventListener('submit', e => {
            e.preventDefault();

            // Validate required fields
            const distanceInput = document.getElementById('distance');
            const paceInput = document.getElementById('pace');
            const elevationInput = document.getElementById('elevation');
            const tempInput = document.getElementById('temperature');

            const distance = parseFloat(distanceInput.value);
            const pace = parseFloat(paceInput.value);
            const elevation = parseFloat(elevationInput.value);
            const temp = parseFloat(tempInput.value);

            // Check if any required field is empty or invalid
            if (!distanceInput.value || isNaN(distance) || distance <= 0) {
                distanceInput.setFocus();
                document.getElementById('distance-validation').open = true;
                return;
            }
            if (!paceInput.value || isNaN(pace) || pace <= 0) {
                paceInput.setFocus();
                document.getElementById('pace-validation').open = true;
                return;
            }
            if (!elevationInput.value || isNaN(elevation) || elevation < 0) {
                elevationInput.setFocus();
                document.getElementById('elevation-validation').open = true;
                return;
            }
            if (!tempInput.value || isNaN(temp)) {
                tempInput.setFocus();
                document.getElementById('temp-validation').open = true;
                return;
            }

            const result = calculateWater(
                distance,
                pace,
                temp,
                parseFloat(uvSlider.value || 0),
                elevation,
                document.getElementById('mouth-breather').checked,
                document.getElementById('heavy-sweater').checked,
                currentUnit
            );

            lastResult = result;
            updateResultDisplay(result);
            
            setTimeout(() => document.getElementById('result-card').scrollIntoView({ behavior: 'smooth', block: 'nearest' }), 100);
        });
    </script>
</body>
</html>